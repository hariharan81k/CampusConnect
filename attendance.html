<!DOCTYPE html>
<html>
<head>
    <title>My Attendance</title>
    <link rel="stylesheet" href="css/attendance-style.css">
</head>
<body>

<div class="page">
    <h2>My Attendance</h2>

    <table id="attendanceTable">
        <tr>
            <th>Subject</th>
            <th>Percentage</th>
        </tr>
        <tbody id="attendanceBody"></tbody>
    </table>
</div>

<script src="script.js"></script>
<script>
    console.log("Attendance JS loaded");

const userid = localStorage.getItem("userid");
console.log("UserID from storage:", userid);

if (!userid) {
    alert("Please login again");
    window.location.href = "index.html";
    throw new Error("No userid");
}

fetch("http://ec2-16-171-137-208.eu-north-1.compute.amazonaws.com/api/student/attendance/" + userid)
    .then(res => {
        console.log("Attendance API status:", res.status);
        return res.json();
    })
    .then(data => {
        console.log("Attendance data:", data);

        const tbody = document.getElementById("attendanceBody");
        tbody.innerHTML = "";

        if (!Array.isArray(data) || data.length === 0) {
            tbody.innerHTML = "<tr><td colspan='2'>No attendance data</td></tr>";
            return;
        }

        data.forEach(a => {
            tbody.innerHTML += `
                <tr>
                    <td>${a.subject}</td>
                    <td>${a.percentage}</td>
                </tr>
            `;
        });
    })
    .catch(err => {
        console.error("Attendance fetch FAILED:", err);
        alert("Failed to load attendance");
    });

</script>
</body>
</html>
